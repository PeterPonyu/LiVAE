(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[162],{2984:(e,a,r)=>{Promise.resolve().then(r.bind(r,6980))},6980:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>er});var t=r(5155),s=r(2115),l=r(5626),n=r(2619),i=r.n(n),o=r(63),d=r(2544),c=r(4561),g=r(8314),m=r(5921),u=r(6132),x=r(1362);let p=e=>{let{dataSummary:a}=e,r=["X",...Object.keys(a.layers)];return(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm mb-6",children:[(0,t.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Dataset Overview"}),(0,t.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-600",children:[a.shape.n_obs.toLocaleString()," cells"]})]})}),(0,t.jsx)("div",{className:"px-6 py-5",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,t.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Cells"}),(0,t.jsx)("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a.shape.n_obs.toLocaleString()})]}),(0,t.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,t.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Genes"}),(0,t.jsx)("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a.shape.n_vars.toLocaleString()})]}),(0,t.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,t.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Layers"}),(0,t.jsx)("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r.length})]}),(0,t.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,t.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"File"}),(0,t.jsx)("span",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",title:a.filename,children:a.filename||"Unknown"})]})]})})]})};var b=r(1983),h=r(5849),y=r(3327),f=r(4033),j=r(2108),v=r(9397),_=r(4639),k=r(3492),N=r(6154);let w=e=>{let{label:a,value:r,defaultValue:s,min:l,max:n,step:i,description:o,formatValue:d,onChange:c,error:g}=e,m=d?d(null!=r?r:s):(null!=r?r:s).toFixed(1);return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a}),(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-md text-xs font-mono font-medium bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-600 min-w-[4rem] justify-center tabular-nums",children:m})]}),(0,t.jsx)("input",{type:"range",min:l,max:n,step:i,value:null!=r?r:s,onChange:e=>c(parseFloat(e.target.value)),title:"Slider input",className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 accent-blue-600 hover:accent-blue-700"}),(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:o}),g&&(0,t.jsxs)("p",{className:"text-xs text-red-600 dark:text-red-400 flex items-center gap-1",children:[(0,t.jsx)(y.A,{className:"w-3 h-3"}),g]})]})},C=e=>{let{label:a,value:r,min:s,max:l,placeholder:n,description:i,onChange:o,error:d}=e;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a}),(0,t.jsx)("input",{type:"number",min:s,max:l,step:1,placeholder:n,value:null!=r?r:"",onChange:e=>{let a=parseInt(e.target.value,10);isNaN(a)||o(a)},className:"w-full px-3 py-2 text-sm font-mono bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:text-gray-100"}),(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:i}),d&&(0,t.jsxs)("p",{className:"text-xs text-red-600 dark:text-red-400 flex items-center gap-1",children:[(0,t.jsx)(y.A,{className:"w-3 h-3"}),d]})]})},M=e=>{let{label:a,value:r,options:s,description:l,onChange:n,error:i}=e;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a}),(0,t.jsx)("select",{value:r,onChange:e=>n(e.target.value),title:"Select data layer",className:"w-full px-3 py-2 text-sm bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:text-gray-100 cursor-pointer",children:s.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:l}),i&&(0,t.jsxs)("p",{className:"text-xs text-red-600 dark:text-red-400 flex items-center gap-1",children:[(0,t.jsx)(y.A,{className:"w-3 h-3"}),i]})]})},S=e=>{let{children:a,variant:r="default"}=e;return(0,t.jsx)("span",{className:"secondary"===r?"inline-flex items-center px-2.5 py-0.5 rounded-md text-xs font-medium bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300":"inline-flex items-center px-2.5 py-0.5 rounded-md text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:a})},q=e=>{let{icon:a,title:r,badge:s,isCollapsed:l,onToggle:n}=e;return(0,t.jsxs)("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between group hover:bg-gray-50 dark:hover:bg-gray-800/50 -mx-2 px-2 py-2 rounded-md transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[a,(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:r})]}),s&&(0,t.jsx)(S,{variant:"secondary",children:s})]}),(0,t.jsx)("div",{className:"text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors",children:l?(0,t.jsx)(f.A,{className:"w-4 h-4"}):(0,t.jsx)(j.A,{className:"w-4 h-4"})})]})},A=e=>{var a,r,l,n,i,o,d,c,g,m,u,x,p,S,A,V,L,T,D,F,I,E,R,z,P,O;let{form:W,availableLayers:H}=e,{register:Q,watch:U,setValue:X,formState:{errors:G}}=W,K=U("agent_parameters"),[B,Y]=(0,s.useState)({dataLayer:!1,architecture:!1,lossWeights:!1,training:!1}),J=e=>{Y(a=>(0,h._)((0,b._)({},a),{[e]:!a[e]}))},Z=Object.values(B).every(e=>e),$=H.map(e=>({value:e,label:"X"===e?"X (Main Layer)":e}));return(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-lg shadow-sm",children:[(0,t.jsx)("div",{className:"px-6 py-5 border-b border-gray-200 dark:border-gray-800",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Model Parameters"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:"Configure the LiVAE model architecture and training hyperparameters"})]}),(0,t.jsx)("button",{type:"button",onClick:()=>{let e=Object.values(B).every(e=>e);Y({dataLayer:!e,architecture:!e,lossWeights:!e,training:!e})},className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md transition-colors",children:Z?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.A,{className:"w-4 h-4"}),"Expand All"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.A,{className:"w-4 h-4"}),"Collapse All"]})})]})}),(0,t.jsxs)("div",{className:"px-6 py-6 space-y-8",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(q,{icon:(0,t.jsx)(v.A,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),title:"Data Layer",badge:"Input Source",isCollapsed:B.dataLayer,onToggle:()=>J("dataLayer")}),!B.dataLayer&&(0,t.jsx)(M,{label:"Data Layer",value:(null==K?void 0:K.layer)||"X",options:$,description:"Choose which data layer to use for training the model",onChange:e=>X("agent_parameters.layer",e),error:null==(r=G.agent_parameters)||null==(a=r.layer)?void 0:a.message})]}),(0,t.jsx)("hr",{className:"border-gray-200 dark:border-gray-700"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(q,{icon:(0,t.jsx)(_.A,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),title:"Architecture",badge:"Network Dimensions",isCollapsed:B.architecture,onToggle:()=>J("architecture")}),!B.architecture&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(C,{label:"Hidden Dimension",value:null==K?void 0:K.hidden_dim,min:16,max:1024,placeholder:"128",description:"Width of encoder and decoder layers",onChange:e=>X("agent_parameters.hidden_dim",e),error:null==(n=G.agent_parameters)||null==(l=n.hidden_dim)?void 0:l.message}),(0,t.jsx)(C,{label:"Latent Dimension",value:null==K?void 0:K.latent_dim,min:2,max:100,placeholder:"10",description:"Size of the latent space representation",onChange:e=>X("agent_parameters.latent_dim",e),error:null==(o=G.agent_parameters)||null==(i=o.latent_dim)?void 0:i.message}),(0,t.jsx)(C,{label:"Interpretable Dim",value:null==K?void 0:K.i_dim,min:2,max:50,placeholder:"5",description:"Size of interpretable embedding space",onChange:e=>X("agent_parameters.i_dim",e),error:null==(c=G.agent_parameters)||null==(d=c.i_dim)?void 0:d.message})]})]}),(0,t.jsx)("hr",{className:"border-gray-200 dark:border-gray-700"}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(q,{icon:(0,t.jsx)(k.A,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),title:"Loss Weights",badge:"Regularization",isCollapsed:B.lossWeights,onToggle:()=>J("lossWeights")}),!B.lossWeights&&(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-x-8 gap-y-6",children:[(0,t.jsx)(w,{label:"Beta (β-VAE)",value:null==K?void 0:K.beta,defaultValue:1,min:.1,max:10,step:.1,description:"KL divergence weight for disentanglement",onChange:e=>X("agent_parameters.beta",e),error:null==(m=G.agent_parameters)||null==(g=m.beta)?void 0:g.message}),(0,t.jsx)(w,{label:"Interpretable Recon",value:null==K?void 0:K.irecon,defaultValue:0,min:0,max:10,step:.1,description:"Weight for embedding reconstruction loss",onChange:e=>X("agent_parameters.irecon",e),error:null==(x=G.agent_parameters)||null==(u=x.irecon)?void 0:u.message}),(0,t.jsx)(w,{label:"Lorentz Distance",value:null==K?void 0:K.lorentz,defaultValue:0,min:0,max:10,step:.1,description:"Hyperbolic geometry regularization penalty",onChange:e=>X("agent_parameters.lorentz",e),error:null==(S=G.agent_parameters)||null==(p=S.lorentz)?void 0:p.message}),(0,t.jsx)(w,{label:"DIP-VAE",value:null==K?void 0:K.dip,defaultValue:0,min:0,max:10,step:.1,description:"Disentangled inferred prior weight",onChange:e=>X("agent_parameters.dip",e),error:null==(V=G.agent_parameters)||null==(A=V.dip)?void 0:A.message}),(0,t.jsx)(w,{label:"Total Correlation",value:null==K?void 0:K.tc,defaultValue:0,min:0,max:10,step:.1,description:"β-TC-VAE total correlation penalty",onChange:e=>X("agent_parameters.tc",e),error:null==(T=G.agent_parameters)||null==(L=T.tc)?void 0:L.message}),(0,t.jsx)(w,{label:"Mutual Information",value:null==K?void 0:K.info,defaultValue:0,min:0,max:10,step:.1,description:"Mutual information penalty weight",onChange:e=>X("agent_parameters.info",e),error:null==(F=G.agent_parameters)||null==(D=F.info)?void 0:D.message})]})]}),(0,t.jsx)("hr",{className:"border-gray-200 dark:border-gray-700"}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(q,{icon:(0,t.jsx)(N.A,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),title:"Training",badge:"Optimization",isCollapsed:B.training,onToggle:()=>J("training")}),!B.training&&(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-x-8 gap-y-6",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Learning Rate"}),(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-md text-xs font-mono font-medium bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-600 min-w-[4rem] justify-center tabular-nums",children:(null!=(P=null==K?void 0:K.lr)?P:.001).toExponential(1)})]}),(0,t.jsx)("input",{type:"range",min:-6,max:-1,step:.1,value:Math.log10(null!=(O=null==K?void 0:K.lr)?O:.001),onChange:e=>X("agent_parameters.lr",Math.pow(10,parseFloat(e.target.value))),title:"Slider input",className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 accent-blue-600 hover:accent-blue-700"}),(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Adam optimizer learning rate (logarithmic scale)"}),(null==(E=G.agent_parameters)||null==(I=E.lr)?void 0:I.message)&&(0,t.jsxs)("p",{className:"text-xs text-red-600 dark:text-red-400 flex items-center gap-1",children:[(0,t.jsx)(y.A,{className:"w-3 h-3"}),G.agent_parameters.lr.message]})]}),(0,t.jsx)(w,{label:"Data Percentage",value:null==K?void 0:K.percent,defaultValue:1,min:.01,max:1,step:.01,description:"Fraction of dataset to use for training",formatValue:e=>"".concat((100*e).toFixed(0),"%"),onChange:e=>X("agent_parameters.percent",e),error:null==(z=G.agent_parameters)||null==(R=z.percent)?void 0:R.message})]})]})]})]})},V=e=>{var a,r,s,l,n,i,o,d,c,g,m,u,x,p,b,h,y,f,j,v,_,k,N,w,C,M,S;let{form:q}=e,A=q.watch("training_config.apply_qc");return(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[(0,t.jsxs)("div",{className:"px-6 py-5 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Quality Control Filters"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:"Apply preprocessing filters to remove low-quality cells and genes"})]}),(0,t.jsxs)("div",{className:"px-6 py-6 space-y-6",children:[(0,t.jsx)("div",{className:"rounded-lg border-2 p-4 transition-all ".concat(A?"border-blue-500 bg-blue-50 dark:bg-blue-950/20":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-base font-semibold text-gray-900 dark:text-gray-100 cursor-pointer",children:"Apply Quality Control"}),(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ".concat(A?"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400"),children:A?"Enabled":"Disabled"})]}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:A?"QC filters will be applied before training":"Enable to configure quality control parameters"})]}),(0,t.jsx)(F,{checked:A,onToggle:()=>{let e=q.getValues("training_config.apply_qc");q.setValue("training_config.apply_qc",!e,{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0})}})]})}),A&&(0,t.jsxs)("div",{className:"space-y-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,t.jsx)(D,{label:"Species",value:q.watch("training_config.qc_params.species")||"human",options:[{value:"human",label:"Human"},{value:"mouse",label:"Mouse"}],description:"Species type for mitochondrial gene detection",onChange:e=>q.setValue("training_config.qc_params.species",e),error:null==(s=q.formState.errors.training_config)||null==(r=s.qc_params)||null==(a=r.species)?void 0:a.message}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Cell Quality Filters"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(L,{label:"Minimum Genes per Cell",description:"Remove cells with fewer detected genes",error:null==(i=q.formState.errors.training_config)||null==(n=i.qc_params)||null==(l=n.min_genes_per_cell)?void 0:l.message,children:(0,t.jsx)(T,{type:"number",placeholder:"e.g., 200",value:null!=(k=q.watch("training_config.qc_params.min_genes_per_cell"))?k:"",onChange:e=>q.setValue("training_config.qc_params.min_genes_per_cell",e.target.value?parseInt(e.target.value):void 0)})}),(0,t.jsx)(L,{label:"Maximum Genes per Cell",description:"Remove cells with too many detected genes",error:null==(c=q.formState.errors.training_config)||null==(d=c.qc_params)||null==(o=d.max_genes_per_cell)?void 0:o.message,children:(0,t.jsx)(T,{type:"number",placeholder:"e.g., 5000",value:null!=(N=q.watch("training_config.qc_params.max_genes_per_cell"))?N:"",onChange:e=>q.setValue("training_config.qc_params.max_genes_per_cell",e.target.value?parseInt(e.target.value):void 0)})}),(0,t.jsx)(L,{label:"Minimum UMI per Cell",description:"Remove cells with low total UMI counts",error:null==(u=q.formState.errors.training_config)||null==(m=u.qc_params)||null==(g=m.min_counts_per_cell)?void 0:g.message,children:(0,t.jsx)(T,{type:"number",placeholder:"e.g., 500",value:null!=(w=q.watch("training_config.qc_params.min_counts_per_cell"))?w:"",onChange:e=>q.setValue("training_config.qc_params.min_counts_per_cell",e.target.value?parseInt(e.target.value):void 0)})}),(0,t.jsx)(L,{label:"Maximum UMI per Cell",description:"Remove cells with extremely high UMI counts",error:null==(b=q.formState.errors.training_config)||null==(p=b.qc_params)||null==(x=p.max_counts_per_cell)?void 0:x.message,children:(0,t.jsx)(T,{type:"number",placeholder:"e.g., 30000",value:null!=(C=q.watch("training_config.qc_params.max_counts_per_cell"))?C:"",onChange:e=>q.setValue("training_config.qc_params.max_counts_per_cell",e.target.value?parseInt(e.target.value):void 0)})})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Gene Type Filters"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(L,{label:"Maximum Mitochondrial %",description:"Remove cells with high mitochondrial gene expression",error:null==(f=q.formState.errors.training_config)||null==(y=f.qc_params)||null==(h=y.max_pct_mt)?void 0:h.message,children:(0,t.jsx)(T,{type:"number",placeholder:"e.g., 20",step:"0.1",value:null!=(M=q.watch("training_config.qc_params.max_pct_mt"))?M:"",onChange:e=>q.setValue("training_config.qc_params.max_pct_mt",e.target.value?parseFloat(e.target.value):void 0)})}),(0,t.jsx)(L,{label:"Maximum Ribosomal %",description:"Remove cells with excessive ribosomal gene expression",error:null==(_=q.formState.errors.training_config)||null==(v=_.qc_params)||null==(j=v.max_pct_ribo)?void 0:j.message,children:(0,t.jsx)(T,{type:"number",placeholder:"e.g., 50",step:"0.1",value:null!=(S=q.watch("training_config.qc_params.max_pct_ribo"))?S:"",onChange:e=>q.setValue("training_config.qc_params.max_pct_ribo",e.target.value?parseFloat(e.target.value):void 0)})})]})]})]})]})]})},L=e=>{let{label:a,description:r,error:s,children:l}=e;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a}),l,r&&(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:r}),s&&(0,t.jsxs)("p",{className:"text-xs text-red-600 dark:text-red-400 flex items-center gap-1",children:[(0,t.jsx)(y.A,{className:"w-3 h-3"}),s]})]})},T=e=>(0,t.jsx)("input",(0,h._)((0,b._)({},e),{className:"w-full px-3 py-2 text-sm bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500"})),D=e=>{let{label:a,value:r,options:s,description:l,onChange:n,error:i}=e;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a}),(0,t.jsx)("select",{value:r,onChange:e=>n(e.target.value),title:"Select species",className:"w-full px-3 py-2 text-sm bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:text-gray-100 cursor-pointer",children:s.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:l}),i&&(0,t.jsxs)("p",{className:"text-xs text-red-600 dark:text-red-400 flex items-center gap-1",children:[(0,t.jsx)(y.A,{className:"w-3 h-3"}),i]})]})},F=e=>{let{checked:a,onToggle:r}=e;return(0,t.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},className:"relative inline-flex h-8 w-14 flex-shrink-0 cursor-pointer items-center rounded-full transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-sm ".concat(a?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500"),children:(0,t.jsx)("span",{className:"inline-block h-6 w-6 transform rounded-full bg-white shadow-lg ring-0 transition-transform duration-200 ease-in-out ".concat(a?"translate-x-7":"translate-x-1")})})},I=e=>{var a,r;let{form:s}=e;return(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[(0,t.jsxs)("div",{className:"px-6 py-5 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Training Settings"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:"Control training duration and monitoring"})]}),(0,t.jsxs)("div",{className:"px-6 py-6 space-y-4",children:[(0,t.jsx)(E,{label:"Epochs",description:"Recommended: 1000-5000 epochs. More epochs = better convergence but longer training time.",error:null==(r=s.formState.errors.training_config)||null==(a=r.epochs)?void 0:a.message,children:(0,t.jsx)(R,{type:"number",min:100,max:1e4,value:s.watch("training_config.epochs"),onChange:e=>s.setValue("training_config.epochs",parseInt(e.target.value)||0)})}),(0,t.jsxs)("div",{className:"flex gap-3 rounded-lg border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-950 p-3",children:[(0,t.jsx)(y.A,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("p",{className:"text-sm text-blue-900 dark:text-blue-200",children:[(0,t.jsx)("strong",{className:"font-semibold",children:"Estimated time:"})," ~5-15 minutes per 1000 epochs for datasets with 10,000 cells"]})]})]})]})},E=e=>{let{label:a,description:r,error:s,children:l}=e;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a}),l,r&&(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:r}),s&&(0,t.jsxs)("p",{className:"text-xs text-red-600 dark:text-red-400 flex items-center gap-1",children:[(0,t.jsx)(y.A,{className:"w-3 h-3"}),s]})]})},R=e=>(0,t.jsx)("input",(0,h._)((0,b._)({},e),{className:"w-full px-3 py-2 text-sm bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 disabled:opacity-50 disabled:cursor-not-allowed"}));var z=r(1894),P=r(1508);let O=P.Ikc({species:P.k5n(["human","mouse"]),min_genes_per_cell:P.aig().min(1,"Must be at least 1").max(1e4,"Must be less than 10,000").optional(),max_genes_per_cell:P.aig().min(100,"Must be at least 100").max(5e4,"Must be less than 50,000").optional(),min_counts_per_cell:P.aig().min(1,"Must be at least 1").max(1e5,"Must be less than 100,000").optional(),max_counts_per_cell:P.aig().min(1e3,"Must be at least 1,000").max(1e6,"Must be less than 1,000,000").optional(),max_pct_mt:P.aig().min(0,"Must be at least 0%").max(100,"Must be less than 100%").optional(),max_pct_ribo:P.aig().min(0,"Must be at least 0%").max(100,"Must be less than 100%").optional()}),W=P.Ikc({layer:P.YjP().min(1,"Layer is required"),percent:P.aig().min(.001,"Must be at least 0.1%").max(1,"Must be at most 100%"),irecon:P.aig().min(0,"Must be non-negative").max(10,"Must be less than 10"),lorentz:P.aig().min(0,"Must be non-negative").max(10,"Must be less than 10"),beta:P.aig().min(.1,"Must be at least 0.1").max(10,"Must be less than 10"),dip:P.aig().min(0,"Must be non-negative").max(10,"Must be less than 10"),tc:P.aig().min(0,"Must be non-negative").max(10,"Must be less than 10"),info:P.aig().min(0,"Must be non-negative").max(10,"Must be less than 10"),hidden_dim:P.aig().min(16,"Must be at least 16").max(1024,"Must be less than 1024"),latent_dim:P.aig().min(2,"Must be at least 2").max(100,"Must be less than 100"),i_dim:P.aig().min(2,"Must be at least 2").max(50,"Must be less than 50"),lr:P.aig().min(1e-6,"Must be at least 1e-6").max(.1,"Must be less than 0.1")}),H=P.Ikc({epochs:P.aig().min(1,"Must be at least 1 epoch").max(1e4,"Must be less than 10,000 epochs"),apply_qc:P.zMY(),qc_params:O.optional()}),Q=P.Ikc({training_config:H,agent_parameters:W});var U=r(8566);let X={training_config:{epochs:1e3,apply_qc:!1,qc_params:U.uf},agent_parameters:U.BK},G=()=>{let e=(0,o.useRouter)(),[a,r]=(0,s.useState)(null),[l,n]=(0,s.useState)(!0),[i,u]=(0,s.useState)("parameters"),{isSubmitting:x,error:y,isSuccess:f,submitTrainingConfig:j,reset:v}=(()=>{let[e,a]=(0,s.useState)({isSubmitting:!1,error:null,isSuccess:!1}),r=(0,s.useCallback)(async e=>{a({isSubmitting:!0,error:null,isSuccess:!1});try{let r=e.agent_parameters,t={epochs:e.training_config.epochs,qcparams:e.training_config.apply_qc?e.training_config.qc_params:void 0},s=await z.FH.startTraining(r,t);s.success?a({isSubmitting:!1,error:null,isSuccess:!0}):a({isSubmitting:!1,error:s.message||"Failed to start training",isSuccess:!1})}catch(e){a({isSubmitting:!1,error:e instanceof Error?e.message:"Failed to start training",isSuccess:!1})}},[]),t=(0,s.useCallback)(()=>{a({isSubmitting:!1,error:null,isSuccess:!1})},[]);return(0,h._)((0,b._)({},e),{submitTrainingConfig:r,reset:t})})(),_=(0,d.mN)({resolver:(0,c.u)(Q),defaultValues:X,mode:"onChange"});if((0,s.useEffect)(()=>{(async()=>{try{let e=await z.FH.getDataSummary();r(e)}catch(e){console.error("No data loaded:",e)}finally{n(!1)}})()},[]),(0,s.useEffect)(()=>{if(f){let a=setTimeout(()=>e.push("/training/monitor"),2e3);return()=>clearTimeout(a)}},[f,e]),l)return(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading configuration..."})]});if(!a)return(0,t.jsx)(B,{variant:"error",children:"No dataset found. Please upload your data first."});let k=["X",...Object.keys(a.layers)];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p,{dataSummary:a}),(0,t.jsxs)("form",{onSubmit:_.handleSubmit(e=>{j(e)}),className:"space-y-6",onKeyDown:e=>{"Enter"===e.key&&e.target!==e.currentTarget&&e.preventDefault()},children:[(0,t.jsxs)(Z,{value:i,onValueChange:u,children:[(0,t.jsxs)($,{children:[(0,t.jsx)(ee,{value:"parameters",children:"Model"}),(0,t.jsx)(ee,{value:"qc",children:"Quality Control"}),(0,t.jsx)(ee,{value:"training",children:"Training"})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)(ea,{value:"parameters",children:(0,t.jsx)(A,{form:_,availableLayers:k})}),(0,t.jsx)(ea,{value:"qc",children:(0,t.jsx)(V,{form:_})}),(0,t.jsx)(ea,{value:"training",children:(0,t.jsx)(I,{form:_})})]})]}),y&&(0,t.jsx)(B,{variant:"error",children:y}),f&&(0,t.jsx)(B,{variant:"success",children:"✓ Training started successfully! Redirecting to monitor..."}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3 justify-end",children:[(0,t.jsxs)(K,{type:"button",variant:"outline",onClick:()=>{_.reset(X),v()},disabled:x,children:[(0,t.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Reset Defaults"]}),(0,t.jsx)(K,{type:"submit",variant:"primary",disabled:x,children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Starting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Start Training"]})})]})]})]})},K=e=>{let{type:a="button",variant:r="primary",disabled:s=!1,onClick:l,children:n}=e;return(0,t.jsx)("button",{type:a,onClick:e=>{"button"===a&&e.preventDefault(),null==l||l()},disabled:s,className:"".concat("inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"," ").concat({primary:"bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-500 disabled:hover:bg-blue-600",outline:"bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:ring-blue-500"}[r]),children:n})},B=e=>{let{variant:a,children:r}=e,s={error:{container:"bg-red-50 dark:bg-red-950 border-red-200 dark:border-red-800",text:"text-red-800 dark:text-red-200",icon:u.A,iconColor:"text-red-600 dark:text-red-400"},success:{container:"bg-green-50 dark:bg-green-950 border-green-200 dark:border-green-800",text:"text-green-800 dark:text-green-200",icon:x.A,iconColor:"text-green-600 dark:text-green-400"},info:{container:"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800",text:"text-blue-800 dark:text-blue-200",icon:u.A,iconColor:"text-blue-600 dark:text-blue-400"}}[a],l=s.icon;return(0,t.jsxs)("div",{className:"flex gap-3 rounded-lg border p-4 ".concat(s.container),children:[(0,t.jsx)(l,{className:"h-5 w-5 flex-shrink-0 mt-0.5 ".concat(s.iconColor)}),(0,t.jsx)("p",{className:"text-sm ".concat(s.text),children:r})]})},Y=(0,s.createContext)(null),J=()=>{let e=(0,s.useContext)(Y);if(!e)throw Error("Tabs components must be used within Tabs");return e},Z=e=>{let{value:a,onValueChange:r,children:s}=e;return(0,t.jsx)(Y.Provider,{value:{value:a,onValueChange:r},children:(0,t.jsx)("div",{className:"space-y-4",children:s})})},$=e=>{let{children:a}=e;return(0,t.jsx)("div",{className:"inline-flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1 w-full",children:(0,t.jsx)("div",{className:"grid w-full grid-cols-3 gap-1",children:a})})},ee=e=>{let{value:a,children:r}=e,{value:s,onValueChange:l}=J(),n=a===s;return(0,t.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),l(a)},className:"px-3 py-2 text-sm font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ".concat(n?"bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100"),children:r})},ea=e=>{let{value:a,children:r}=e,{value:s}=J();return a!==s?null:(0,t.jsx)("div",{role:"tabpanel",className:"space-y-4",children:r})};function er(){return(0,t.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-6xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Training Configuration"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Configure model parameters and start training"})]}),(0,t.jsxs)(i(),{href:"/",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:[(0,t.jsx)(l.A,{className:"mr-2 h-4 w-4"}),"Home"]})]}),(0,t.jsx)(G,{})]})}}},e=>{e.O(0,[223,745,697,255,358],()=>e(e.s=2984)),_N_E=e.O()}]);